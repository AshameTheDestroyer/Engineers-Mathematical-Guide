import{n as q,u as z,j as e,F as u,d as L,b as S,B as D,L as N,z as m,o as re,k as X,p as Z,r as I,q as ne,s as oe,l as ie,m as ce}from"./index-DNwHBppe.js";import{Q as f,L as B}from"./LessonSchema-CmXiW02j.js";import{B as G}from"./ButtonBox-DWJE82HV.js";import{S as _}from"./SearchResultDisplay-QL6_W1If.js";import{c as R}from"./check-CUtO5-iS.js";import{c as F,C as le}from"./Checkbox-CazshlQK.js";import{l}from"./modules_page-B4EyZNEX.js";import{M as de}from"./Markdown-DM4UdJm7.js";import{J as me}from"./JumpToStartButton-DIdyyAqm.js";import{u as ue,L as pe}from"./LessonDropView-ChcQ5NIN.js";import{u as he}from"./useSchematicQueryParams-srqs-Vt1.js";import{R as U}from"./RichText--LUasi-H.js";import{M as W}from"./MathExpression-C_kvjjbc.js";import{a as O}from"./arrow-CEXDshSc.js";import{w as xe}from"./warning-WOCtKT8O.js";import{u as ge}from"./useGetLessonByID-BaGL6jDX.js";import{u as be}from"./useGetEnrollmentByID-CM2FUa9D.js";import"./network_error-BFEUb7Sm.js";import"./Input-c5OJGOhB.js";import"./Separator-BvQIrVzx.js";import"./useElementInformation-ByzT6j6u.js";const fe=({lesson:s,enrollment:t})=>{const{isDarkThemed:g}=q(),{language:n,GetLocale:o}=z();return e.jsxs(u,{className:"grow",gap:"8",direction:"column",children:[e.jsx(u,{gap:"4",placeItems:"end",placeContent:"space-between",children:e.jsxs(L,{className:"text-xl font-bold max-sm:text-lg",variant:"h1",children:[s.title," ",e.jsx("span",{children:`(${Intl.DateTimeFormat("en-US",{minute:"2-digit",second:"2-digit"}).format(new Date(0,0,0,0,0,s.duration-1))})`})]})}),e.jsxs(u,{className:S("sm:border-background-darker relative min-h-[60dvh] grow max-sm:-mx-10 sm:rounded-2xl sm:border-2 sm:p-4",g?"sm:bg-background-normal/50":"sm:bg-background-dark/50"),children:[e.jsx(u,{className:"-translate-1/2 absolute left-1/2 top-1/2",gap:"4",direction:"column",placeItems:"center",children:e.jsx(_,{iconType:"loading",title:o(l.lessons.video.loading.title,n),paragraph:o(l.lessons.video.loading.paragraph,n)})}),e.jsx("iframe",{className:"z-1 w-full sm:rounded-2xl",allow:"fullscreen",src:s.url+"?"+new URLSearchParams({rel:"0",hl:n,modestbranding:"1",cc_load_policy:"1",cc_lang_pref:n})})]}),e.jsx(G,{direction:"reverse-row",children:e.jsx(D,{className:S(t=="passed"&&"font-bold",t=="unenrolled"&&"pointer-events-none opacity-0"),thickness:"thick",variant:t=="passed"?"success":"default",disabled:t!="enrolled",tabIndex:t!="enrolled"?0:-1,icon:{placement:"right",source:t=="passed"?F:R},children:e.jsx(N,{children:l.lessons.buttons[t=="passed"?"completed":"mark-completeness"]})})})]})},je=m.object({element:m.string(),props:m.record(m.union([m.string(),m.number(),m.boolean(),m.null(),m.undefined()])).optional()}),A=m.intersection(je,m.lazy(()=>m.object({children:m.union([m.string().optional(),m.array(A).optional()]).optional()}))),ke="get-markdown-by-id",ye=(s,t,g)=>re({schema:A,queryFn:async()=>{const n=await fetch(`data/lessons/reading/${s}.json`);try{return await n.json()}catch{return[]}},parseFn:(n,o)=>(n==null?void 0:n.map(i=>o.parse(i)))??[],...t,queryKey:[ke,s,...(t==null?void 0:t.queryKey)??[]]},g),ve=({lesson:s,enrollment:t})=>{const{isDarkThemed:g}=q(),{language:n,GetLocale:o}=z(),{data:i}=ye(s.id,{usesSuspense:!0});return e.jsxs(u,{className:"grow",gap:"8",direction:"column",children:[e.jsx(u,{gap:"4",placeItems:"end",placeContent:"space-between",children:e.jsxs(L,{className:"text-xl font-bold max-sm:text-lg",variant:"h1",children:[s.title," ",e.jsx("span",{children:`(${Intl.DateTimeFormat("en-US",{minute:"numeric"}).format(new Date(0,0,0,0,0,s["estimated-reading-time"]))} minutes)`})]})}),e.jsxs(u,{className:S("sm:border-background-darker grow sm:h-[60dvh] sm:overflow-auto sm:rounded-2xl sm:border-2 sm:p-8 max-sm:[&::-webkit-scrollbar]:hidden",g?"sm:bg-background-normal/50":"sm:bg-background-dark/50"),gap:"8",direction:"column",children:[i.length>0?i.map((j,b)=>e.jsx(de,{...j},b)):e.jsx(_,{className:"-translate-1/2 absolute left-1/2 top-1/2",iconType:"empty",title:o(l.lessons.reading.empty.title,n),paragraph:o(l.lessons.reading.empty.paragraph,n).replace(/\*\*([^\*]+)\*\*/,`**"${s.title}"**`)}),e.jsx(me,{className:"right-0! left-0! bottom-0! place-self-end",isContainerized:!0,orientation:"vertical"})]}),e.jsx(G,{direction:"reverse-row",children:e.jsx(D,{className:S(t=="passed"&&"font-bold",t=="unenrolled"&&"pointer-events-none opacity-0"),thickness:"thick",variant:t=="passed"?"success":"default",disabled:t!="enrolled",tabIndex:t!="enrolled"?0:-1,icon:{placement:"right",source:t=="passed"?F:R},children:e.jsx(N,{children:l.lessons.buttons[t=="passed"?"completed":"mark-completeness"]})})})]})},Y=({type:s,index:t,title:g,points:n,answer:o,answers:i,options:j,chosenAnswer:b,chosenAnswers:d,setChosenAnswer:k,setChosenAnswers:y,showCorrectAnswers:v})=>{function T(p){return v?(()=>{switch(s){case f.choose:return o==p;case f.select:return i.includes(p)}})()?(()=>{switch(s){case f.choose:return b==p;case f.select:return d.includes(p)}})()?"success":"primary":(()=>{switch(s){case f.choose:return b==p;case f.select:return d.includes(p)}})()?"error":"default":"default"}return e.jsxs(u,{gap:"8",direction:"column",children:[e.jsxs(u,{className:"gap-4 max-sm:gap-2",placeContent:"space-between",children:[e.jsx(U,{variant:"h3",className:"font-bold sm:text-lg",extractor:"$",dir:"ltr",ExtractedTextRenders:p=>e.jsx(W,{className:"inline-block",inline:!0,variant:"span",children:p}),children:`${t}. ${g}`}),e.jsxs(L,{className:"bg-tertiary-normal text-tertiary-light place-self-start text-nowrap rounded-full px-4 py-2 font-bold",variant:"span",children:[n," ",e.jsx(N,{children:l.lessons.examination.question.points[n<=1?"singular":"plural"]})]})]}),e.jsx(u,{gap:"4",direction:"column",children:j.map((p,h)=>e.jsx(le,{className:"[&>label]:bg-transparent",isControlled:!0,variant:T(h),name:`answer-${t}-${h}`,isRadio:s==f.choose,checked:s==f.choose?b==h:d.includes(h),label:e.jsx(U,{variant:"label",extractor:"$",ExtractedTextRenders:w=>e.jsx(W,{className:"inline-block",inline:!0,variant:"span",children:w}),children:p}),onChange:w=>!v&&(s==f.choose?k(h):y(a=>w.target.checked?[...a,h]:a.filter(M=>M!=h)))},h))},`${b??-1}-${(d==null?void 0:d.length)??0}`)]})},H="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='32'%20height='32'%20viewBox='0%200%2016%2016'%3e%3cpath%20fill='currentColor'%20d='M2.5%2015a.5.5%200%201%201%200-1h1v-1a4.5%204.5%200%200%201%202.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5%204.5%200%200%201%203.5%203V2h-1a.5.5%200%200%201%200-1h11a.5.5%200%200%201%200%201h-1v1a4.5%204.5%200%200%201-2.557%204.06c-.29.139-.443.377-.443.59v.7c0%20.213.154.451.443.59A4.5%204.5%200%200%201%2012.5%2013v1h1a.5.5%200%200%201%200%201zm2-13v1c0%20.537.12%201.045.337%201.5h6.326c.216-.455.337-.963.337-1.5V2zm3%206.35c0%20.701-.478%201.236-1.011%201.492A3.5%203.5%200%200%200%204.5%2013s.866-1.299%203-1.48zm1%200v3.17c2.134.181%203%201.48%203%201.48a3.5%203.5%200%200%200-1.989-3.158C8.978%209.586%208.5%209.052%208.5%208.351z'%20/%3e%3c/svg%3e",we=m.object({tab:m.string({required_error:"required"}).regex(/\d*/,"pattern").default("0")}),Ne=({lesson:s,courseID:t,moduleID:g,lessonID:n,enrollment:o})=>{const{myUser:i}=X(),{isDarkThemed:j}=q(),{direction:b,language:d,GetGenderedLocale:k}=z(),{queryParams:y,setQueryParams:v}=he(we),{StoreTab:T,StartExamination:p,FinalizeExamination:h,TerminateExamination:w,examinationInformation:a,SetExaminationChosenAnswers:M}=Z(),[$,P]=I.useState(V()),[x,Q]=I.useState((a==null?void 0:a["last-tab"])??+y.tab);I.useEffect(()=>{T(x),v(r=>({...r,tab:`${x+1}`}))},[x]),I.useEffect(()=>{if(a==null)return;const r=setInterval(()=>{a==null&&clearInterval(r),P(V())},500);return()=>{clearInterval(r)}},[a==null?void 0:a["finishes-at"]]);const ee=r=>c=>M(C=>C.with(r,typeof c=="number"?c:c==null?void 0:c(C[r]))),se=r=>c=>M(C=>C.with(r,Array.isArray(c)?c:c==null?void 0:c(C[r])));function V(){return a==null?s.time*60*1e3:Math.max(-1,new Date(a["finishes-at"]).getTime()-Date.now())}function ae(r){const c=Math.floor(Math.max(0,r)/1e3),C=Math.floor(c/60),te=c%60;return`${C.toString().padStart(2,"0")}:${te.toString().padStart(2,"0")}`}const E=a!=null&&[a.courseID==t,a.moduleID==g,a.lessonID==n].every(Boolean),K=E&&(a["check-my-answers"]||!a.finalized&&a["chosen-answers"].map(r=>Array.isArray(r)?r.length>0:r!=null).every(Boolean)),J=E&&a.finalized&&a["check-my-answers"];return e.jsxs(u,{className:"grow",gap:"8",direction:"column",children:[e.jsxs(u,{gap:"4",placeItems:"end",placeContent:"space-between",children:[e.jsx(L,{className:"text-xl font-bold max-sm:text-lg",variant:"h1",children:s.title}),E&&$>=0&&e.jsxs(u,{className:S("border-background-darker max-sm:text-md translate-y-2 text-nowrap rounded-2xl border-2 px-4 py-2 text-lg",j?"bg-background-normal/50":"bg-background-dark/50"),gap:"2",placeItems:"center",children:[e.jsx(ne,{className:"hourglass-icon aspect-square max-sm:w-[24px] [&>svg]:h-full [&>svg]:w-full",source:H}),e.jsx("span",{className:"min-w-[5ch] text-end",children:ae($)})]})]}),e.jsx(u,{className:S("sm:border-background-darker relative min-h-[60dvh] grow p-4 max-sm:-mx-8 max-sm:-mt-4 sm:rounded-2xl sm:border-2",j?"sm:bg-background-normal/50":"sm:bg-background-dark/50"),children:a==null?e.jsx(_,{className:"sm:-translate-1/2 sm:absolute sm:left-1/2 sm:top-1/2",iconType:"custom",iconProps:{source:xe},title:k(l.lessons.examination.disclaimer.title,d,i.gender),paragraph:k(l.lessons.examination.disclaimer.paragraph,d,i.gender).replace(/\*\*([^\*]+)\*\*/g,r=>r.startsWith("**#")?`**${s.time}**`:r),buttons:e.jsx(D,{thickness:"thick",onClick:r=>p({courseID:t,lessonID:n,moduleID:g,"last-tab":0,finalized:!1,"check-my-answers":!1,"finishes-at":new Date(Date.now()+s.time*60*1e3).toISOString(),"chosen-answers":s.questions.map(c=>{switch(c.type){case f.choose:return;case f.select:return[]}})}),children:e.jsx(N,{gender:i.gender,children:l.lessons.examination.disclaimer.buttons.proceed})})}):$==-1&&a!=null?e.jsx(_,{className:"sm:-translate-1/2 sm:absolute sm:left-1/2 sm:top-1/2",iconType:"custom",iconProps:{source:H},title:k(l.lessons.examination["times-up"].title,d,i.gender),paragraph:k(l.lessons.examination["times-up"].paragraph,d,i.gender).replace(/\*\*([^\*]+)\*\*/g,r=>r.startsWith("**#")?`**${s.time}**`:r),buttons:e.jsx(D,{thickness:"thick",onClick:r=>(w(),P(1/0)),children:e.jsx(N,{gender:i.gender,children:l.lessons.examination["times-up"].buttons.reset})})}):e.jsxs(u,{className:"w-full sm:p-4",gap:"8",direction:"column",children:[(()=>{switch(s.questions[x].type){case f.choose:return e.jsx(Y,{index:x+1,...s.questions[x],showCorrectAnswers:J,setChosenAnswer:ee(x),chosenAnswer:a["chosen-answers"][x]});case f.select:return e.jsx(Y,{index:x+1,...s.questions[x],showCorrectAnswers:J,setChosenAnswers:se(x),chosenAnswers:a["chosen-answers"][x]})}})(),e.jsxs(u,{className:"mt-auto",placeContent:"space-between",children:[e.jsx(D,{className:"min-w-[calc(8ch+1rem)]",disabled:x==0,icon:{placement:"left",source:O,className:b=="ltr"?"rotate-270":"rotate-90"},onClick:r=>Q(c=>c-1),children:e.jsx(N,{children:l.lessons.examination.question.buttons.previous})}),e.jsx(L,{className:"bg-tertiary-normal text-tertiary-light min-w-[calc(3ch+2rem)] place-self-start text-nowrap rounded-full px-4 py-2 text-center font-bold",variant:"p",children:x+1}),e.jsx(D,{className:"min-w-[calc(8ch+1rem)]",disabled:x==s.questions.length-1,icon:{placement:"right",source:O,className:b=="ltr"?"rotate-90":"rotate-270"},onClick:r=>Q(c=>c+1),children:e.jsx(N,{children:l.lessons.examination.question.buttons.next})})]})]})}),e.jsx(G,{direction:"reverse-row",children:e.jsx(D,{className:S(o=="passed"&&"font-bold",o=="unenrolled"&&"pointer-events-none opacity-0"),thickness:"thick",variant:o=="passed"?"success":"default",disabled:$==0&&a!=null||o!="enrolled"||!K,tabIndex:$==0&&a!=null||o!="enrolled"||!K?0:-1,icon:E&&o!="passed"?void 0:{placement:"right",source:o=="passed"?F:R},onClick:r=>a!=null&&a["check-my-answers"]?w():E?h():void 0,children:e.jsx(N,{children:l.lessons.buttons[o=="passed"?"completed":E?"finish-exam":"mark-completeness"]})})})]})},Ue=()=>{const{myUser:s}=X(),{isDarkThemed:t}=q(),{isScreenSize:g}=oe(),{language:n,GetLocale:o}=z(),{courseID:i,moduleID:j,lessonID:b}=ie(),{examinationInformation:d}=Z(),{data:k}=ue(i,j,{usesSuspense:!0}),{data:y}=ge(i,j,b,{usesSuspense:!0}),{data:v}=be(i,s==null?void 0:s.username,{usesSuspense:!0,enabled:i!=null&&s!=null}),T=v==null?void 0:v.progress.find(w=>w.module==(k==null?void 0:k.id));if(i==null||j==null)return e.jsx(_,{className:"grow",iconType:"empty",title:o(l.display.empty.title,n),paragraph:o(l.display.empty.paragraph,n).replace(/\*\*([^\*]+)\*\*/,`**"${i}"**`)});if(b==null||y==null)return e.jsx(_,{className:"grow",iconType:"empty",title:o(l.lessons.empty.title,n),paragraph:o(l.lessons.empty.paragraph,n).replace(/\*\*([^\*]+)\*\*/,`**"${j}"**`)});const p=Number(b??0)-1,h=v==null||T==null?"unenrolled":p<T["finished-lessons"]?"passed":p>T["finished-lessons"]?"unenrolled":"enrolled";return e.jsxs(u,{className:"grow",gap:"8",variant:"main",direction:g["max-xl"]?"column-reverse":"row",children:[e.jsx(ce,{children:y.title}),e.jsx(pe,{className:S("border-background-darker rounded-2xl border-2 xl:max-h-[calc(100dvh-var(--spacing-page)*2-var(--spacing)*16)] xl:min-w-[32rem] xl:max-w-[32rem] xl:overflow-y-auto xl:overflow-x-hidden",t?"bg-background-normal/50":"bg-background-dark/50"),orientation:g["max-sm"]||g.xl?"portrait":"landscape"}),(()=>{switch(y.type){case B.video:return e.jsx(fe,{lesson:y,enrollment:h});case B.reading:return e.jsx(ve,{lesson:y,enrollment:h});case B.examination:return e.jsx(Ne,{lesson:y,enrollment:h,courseID:i,moduleID:j,lessonID:b},`${(d==null?void 0:d.finalized)??!1}${(d==null?void 0:d["check-my-answers"])??!1}`)}})()]})};export{Ue as LessonPage};
