import{u as I,s as _,n as C,j as e,t as B,b as p,d as k,F as v,L as y,B as E,D as L,l as G,k as O,m as P}from"./index-DNwHBppe.js";import{P as M}from"./ProgressBar-C4FFtJS4.js";import{f as S,u as R}from"./useGetModulesByIDs-Bitr63rh.js";import{s as F}from"./variant_success-Cukf3QWI.js";import{l as m}from"./modules_page-B4EyZNEX.js";import{C as $}from"./CourseBanner-CW3rDxgm.js";import{u as q}from"./useGetCourseByID-De2EBitw.js";import{u as U}from"./useGetEnrollmentByID-CM2FUa9D.js";import{S as D}from"./SearchResultDisplay-QL6_W1If.js";import"./CardSummary-CZwssmAi.js";import"./Rating-BN8P6HtX.js";import"./star-B-UdhycM.js";import"./user-BgdDnp0D.js";import"./Image-iq2M_NKL.js";import"./network_error-BFEUb7Sm.js";import"./courses_page-CmId8-xS.js";import"./CourseSchema-b2jpAZrW.js";import"./RichText--LUasi-H.js";const V=({id:x,ref:N,module:a,courseID:f,className:b,enrollment:o})=>{var l;const{direction:u}=I(),{orientation:n}=_(),{isDarkThemed:j}=C(),h=Object.fromEntries(((o==null?void 0:o.progress)??[]).map(c=>[c.module,{...Object.omit(c,"module")}])),t=a["lesson-count"],i=((l=h[a.id])==null?void 0:l["finished-lessons"])??0,g=o!=null&&h[a.id]!=null,r=h[a.id]!=null&&i==t&&h[a.id].grade!=null;return e.jsxs("figure",{id:x,ref:N,className:B("border-background-darker relative flex flex-col gap-4 rounded-lg border-2 p-6",j?"bg-background-normal/50":"bg-background-dark/50",n=="landscape"&&"min-w-[20rem] max-w-[30rem]",n=="landscape"&&r&&(u=="ltr"?"mr-6":"ml-6"),b),children:[r&&e.jsx("span",{className:p(u=="ltr"?"right-4 translate-x-1/2":"left-4 -translate-x-1/2","z-1 bg-vibrant-green-normal border-vibrant-green-dark absolute top-4 flex aspect-square min-w-[calc(5ch+1rem)] -translate-y-1/2 place-content-center place-items-center rounded-full border-2 text-center font-bold text-white"),children:e.jsxs("p",{className:"scale-80",children:[Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(h[a.id].grade),"%"]})}),e.jsx(k,{className:p(u=="ltr"?"mr-12":"ml-12 text-end","text-lg font-bold"),dir:"ltr",variant:"h3",children:a.title}),e.jsx(k,{className:"grow",variant:"p",dir:"ltr",children:a.description}),g&&e.jsxs(v,{direction:"column",gap:"4",children:[e.jsxs(k,{className:"text-lg font-bold",variant:"h4",children:[e.jsx(y,{children:m.card.progress})," (",i,"/",t,")"]}),e.jsx(M,{className:p("my-4 w-[calc(100%-3rem)] place-self-center max-md:[&_[data-checkpoint]:not(:nth-of-type(2))]:scale-75 md:[&_[data-checkpoint]:nth-of-type(2)]:scale-125",i!=t&&i>0?"[&_[data-checkpoint]:nth-of-type(2)]:z-1":"[&_[data-checkpoint]:last-of-type]:z-1"),minimum:0,maximum:t,value:i,variant:r?"success":g?"secondary":"default",checkpoints:[i,{value:0,icon:{source:S}},r?{icon:{source:F},value:t}:t]})]}),e.jsx(E,{className:p(g&&"font-bold"),variant:r?"success":g?"secondary":"default",link:L.base.routes.moduleID.MapVariables({courseID:f,moduleID:a.id.replace(/^[^-]*-/,"")}),children:e.jsx(y,{children:m.card.buttons[r?"review":g?"continue":"open"]})})]})},ie=()=>{const{orientation:x}=_(),{isDarkThemed:N}=C(),{direction:a,language:f,GetLocale:b}=I(),{courseID:o}=G(),{myUser:u}=O(),{data:n,isError:j,refetch:h}=q(o,{usesSuspense:!0}),{data:t,isError:i,refetch:g}=R((n==null?void 0:n.modules)??[],{usesSuspense:!0,enabled:o!=null}),{data:r}=U(o,u==null?void 0:u.username,{usesSuspense:!0,enabled:o!=null&&u!=null}),l=(r==null?void 0:r.progress.reduce((s,d)=>s+d["finished-lessons"],0))??0,c=t.reduce((s,d)=>s+d["lesson-count"],0),w=r!=null&&r.progress.every(s=>s.grade!=null)?r.progress.reduce((s,d)=>s+d.grade,0)/r.progress.length:void 0,z=t.reduce((s,d,T)=>(s.array.push({value:s.counter+=d["lesson-count"],label:`M${T+1}`}),s),{array:[],counter:0}).array;return j||i?e.jsx(D,{className:"grow",iconType:"error",title:b(m.display.error.title,f),paragraph:b(m.display.error.paragraph,f),buttons:e.jsx(E,{onClick:s=>j?h():i?g():{},children:e.jsx(y,{children:m.display.error.button})})}):n==null||t.length==0?e.jsx(D,{className:"grow",iconType:"empty",title:b(m.display.empty.title,f),paragraph:b(m.display.empty.paragraph,f).replace(/\*\*([^\*]+)\*\*/,`**"${o}"**`)}):e.jsxs(v,{className:"grow",variant:"main",direction:"column",gap:"8",children:[e.jsx(P,{children:`Modules of ${n.title}`}),e.jsx($,{course:n}),e.jsx(y,{className:"order-2 text-2xl font-bold",variant:"h1",children:m.title}),e.jsx(v,{className:p("order-3",x=="landscape"&&"overflow-auto py-6 pb-4"),gap:x=="landscape"?4:8,direction:x=="landscape"?"row":"column",children:t.map((s,d)=>e.jsx(V,{module:s,className:"flex-1",courseID:n.id,enrollment:r},d))}),r!=null&&e.jsxs(v,{className:p("border-background-darker relative rounded-lg border-2 p-6",N?"bg-background-normal/50":"bg-background-dark/50",x=="portrait"?"order-1":"order-4"),gap:"4",direction:"column",children:[l==c&&w!=null&&e.jsx("span",{className:p(a=="ltr"?"right-4 translate-x-1/2":"left-4 -translate-x-1/2","z-1 bg-vibrant-green-normal border-vibrant-green-dark absolute top-4 flex aspect-square min-w-[calc(5ch+1rem)] -translate-y-1/2 place-content-center place-items-center rounded-full border-2 text-center font-bold text-white"),children:e.jsxs("p",{className:"scale-80",children:[Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(w),"%"]})}),e.jsxs(k,{className:"text-xl font-bold max-md:text-lg",variant:"h1",children:[e.jsx(y,{children:m["total-progress"]})," (",l,"/",c,")"]}),e.jsx(M,{className:p("my-4 w-[calc(100%-2rem)] place-self-center max-md:[&_[data-checkpoint]:not(:nth-of-type(2))]:scale-75 md:[&_[data-checkpoint]:nth-of-type(2)]:scale-125",l!=c&&l>0?"[&_[data-checkpoint]:nth-of-type(2)]:z-1":"[&_[data-checkpoint]:last-of-type]:z-1"),minimum:0,maximum:c,value:l,checkpoints:[l,{value:0,icon:{source:S}},...z,l!=c?c:{value:c,icon:{source:F}}]})]})]})};export{ie as ModulesPage};
