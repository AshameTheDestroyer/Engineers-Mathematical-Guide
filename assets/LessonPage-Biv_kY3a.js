import{n as G,u as M,j as e,F as x,d as q,b as N,B as _,L as S,t as L,z as h,o as oe,k as Z,p as A,r as I,q as ce,s as le,l as ie,m as de}from"./index-Dj5WZ14J.js";import{Q as k,L as R}from"./LessonSchema-CnppMMUi.js";import{B as P}from"./ButtonBox-DdRcAhQf.js";import{S as E}from"./SearchResultDisplay-BOsfc9EN.js";import{c as Q}from"./check-CUtO5-iS.js";import{c as V,C as me}from"./Checkbox-CJaRGmZz.js";import{l as p}from"./modules_page-B4EyZNEX.js";import{R as F}from"./RichText-CgGjn9vV.js";import{S as ue}from"./Separator-BbHT-WHp.js";import{M as B}from"./MathExpression-JSJchDpC.js";import{J as pe}from"./JumpToStartButton-Bu-73mrd.js";import{u as he,L as xe}from"./LessonDropView-CQGLJK79.js";import{u as ge}from"./useSchematicQueryParams-h9FxQJpe.js";import{a as Y}from"./arrow-CEXDshSc.js";import{w as be}from"./warning-WOCtKT8O.js";import{u as fe}from"./useGetLessonByID-DqR7DeKa.js";import{u as je}from"./useGetEnrollmentByID-DxP3rFg9.js";import"./network_error-BFEUb7Sm.js";import"./Input-CSFMW74V.js";import"./useElementInformation-CMenbtIN.js";const ke=({lesson:s,enrollment:a})=>{const{isDarkThemed:m}=G(),{language:n,GetLocale:c}=M();return e.jsxs(x,{className:"grow",gap:"8",direction:"column",children:[e.jsx(x,{gap:"4",placeItems:"end",placeContent:"space-between",children:e.jsxs(q,{className:"text-xl font-bold max-sm:text-lg",variant:"h1",children:[s.title," ",e.jsx("span",{children:`(${Intl.DateTimeFormat("en-US",{minute:"2-digit",second:"2-digit"}).format(new Date(0,0,0,0,0,s.duration-1))})`})]})}),e.jsxs(x,{className:N("sm:border-background-darker relative min-h-[60dvh] grow max-sm:-mx-10 sm:rounded-2xl sm:border-2 sm:p-4",m?"sm:bg-background-normal/50":"sm:bg-background-dark/50"),children:[e.jsx(x,{className:"-translate-1/2 absolute left-1/2 top-1/2",gap:"4",direction:"column",placeItems:"center",children:e.jsx(E,{iconType:"loading",title:c(p.lessons.video.loading.title,n),paragraph:c(p.lessons.video.loading.paragraph,n)})}),e.jsx("iframe",{className:"z-1 w-full sm:rounded-2xl",allow:"fullscreen",src:s.url+"?"+new URLSearchParams({rel:"0",hl:n,modestbranding:"1",cc_load_policy:"1",cc_lang_pref:n})})]}),e.jsx(P,{direction:"reverse-row",children:e.jsx(_,{className:N(a=="passed"&&"font-bold",a=="unenrolled"&&"pointer-events-none opacity-0"),thickness:"thick",variant:a=="passed"?"success":"default",disabled:a!="enrolled",tabIndex:a!="enrolled"?0:-1,icon:{placement:"right",source:a=="passed"?V:Q},children:e.jsx(S,{children:p.lessons.buttons[a=="passed"?"completed":"mark-completeness"]})})})]})},ee=({props:s,element:a,children:m})=>{const{direction:n}=M(),c=(()=>{switch(a){case"ul":return({className:r,...i})=>e.jsx("ul",{className:L("list-disc",n=="ltr"?"pl-8":"pr-8",r),...i});case"li":if(typeof m!="string")return r=>e.jsx("li",{...r});case"a":case"p":case"q":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"th":case"td":return({className:r,children:i,...d})=>e.jsx(F,{className:L({h1:"text-2xl font-bold",h2:"text-xl font-bold",h3:"text-lg font-bold",h4:"text-md font-bold",h5:"text-xs font-bold",h6:"text-xs",a:"text-secondary-normal font-bold underline",q:N("bg-background-dark-hover border-3 border-transparent",n=="ltr"?"border-l-primary-normal! rounded-r-lg pl-2":"border-r-primary-normal! rounded-l-lg pr-2")}[a],r),variant:a,ExtractedTextRenders:g=>g.startsWith("$")&&g.endsWith("$")?e.jsx(B,{className:"inline-block",inline:!0,variant:"span",children:g.slice(1,-1)}):e.jsx("span",{className:"text-primary-normal font-bold",children:g}),...d,children:i});case"mathjax":return({className:r,children:i,...d})=>e.jsx(B,{variant:"p",className:L("text-center",r),...d,children:i});case"table":return({className:r,...i})=>e.jsx("table",{className:L("[&_:is(td,th)]:border-background-darker [&>thead>tr]:bg-background-dark-active [&>tbody>tr:nth-of-type(2n)]:bg-background-dark-hover [&>tbody>tr:nth-of-type(2n+1)]:bg-background-normal [&_:is(td,th)]:border-2 [&_:is(td,th)]:p-2 [&_:is(td,th)]:text-start",r),...i});case"hr":return({className:r,...i})=>e.jsx(ue,{className:L("border-background-dark-hover",r),thickness:"thick",orientation:"horizontal",...i});default:const l=a;return r=>e.jsx(l,{...r})}})();return e.jsx(c,{...s,children:m==null?void 0:typeof m=="string"?m:m.map((l,r)=>e.jsx(ee,{...l},r))})},ye=h.object({element:h.string(),props:h.record(h.union([h.string(),h.number(),h.boolean(),h.null(),h.undefined()])).optional()}),se=h.intersection(ye,h.lazy(()=>h.object({children:h.union([h.string().optional(),h.array(se).optional()]).optional()}))),ve="get-markdown-by-id",we=(s,a,m)=>oe({schema:se,queryFn:async()=>{const n=await fetch(`data/lessons/reading/${s}.json`);try{return await n.json()}catch{return[]}},parseFn:(n,c)=>(n==null?void 0:n.map(l=>c.parse(l)))??[],...a,queryKey:[ve,s,...(a==null?void 0:a.queryKey)??[]]},m),Ne=({lesson:s,enrollment:a})=>{const{isDarkThemed:m}=G(),{language:n,GetLocale:c}=M(),{data:l}=we(s.id,{usesSuspense:!0});return e.jsxs(x,{className:"grow",gap:"8",direction:"column",children:[e.jsx(x,{gap:"4",placeItems:"end",placeContent:"space-between",children:e.jsxs(q,{className:"text-xl font-bold max-sm:text-lg",variant:"h1",children:[s.title," ",e.jsx("span",{children:`(${Intl.DateTimeFormat("en-US",{minute:"numeric"}).format(new Date(0,0,0,0,0,s["estimated-reading-time"]))} minutes)`})]})}),e.jsxs(x,{className:N("sm:border-background-darker grow sm:h-[60dvh] sm:overflow-auto sm:rounded-2xl sm:border-2 sm:p-8 max-sm:[&::-webkit-scrollbar]:hidden",m?"sm:bg-background-normal/50":"sm:bg-background-dark/50"),gap:"8",direction:"column",children:[l.length>0?l.map((r,i)=>e.jsx(ee,{...r},i)):e.jsx(E,{className:"-translate-1/2 absolute left-1/2 top-1/2",iconType:"empty",title:c(p.lessons.reading.empty.title,n),paragraph:c(p.lessons.reading.empty.paragraph,n).replace(/\*\*([^\*]+)\*\*/,`**"${s.title}"**`)}),e.jsx(pe,{className:"right-0! left-0! bottom-0! place-self-end",isContainerized:!0,orientation:"vertical"})]}),e.jsx(P,{direction:"reverse-row",children:e.jsx(_,{className:N(a=="passed"&&"font-bold",a=="unenrolled"&&"pointer-events-none opacity-0"),thickness:"thick",variant:a=="passed"?"success":"default",disabled:a!="enrolled",tabIndex:a!="enrolled"?0:-1,icon:{placement:"right",source:a=="passed"?V:Q},children:e.jsx(S,{children:p.lessons.buttons[a=="passed"?"completed":"mark-completeness"]})})})]})},H=({type:s,index:a,title:m,points:n,answer:c,answers:l,options:r,chosenAnswer:i,chosenAnswers:d,setChosenAnswer:g,setChosenAnswers:y,showCorrectAnswers:v})=>{function T(b){return v?(()=>{switch(s){case k.choose:return c==b;case k.select:return l.includes(b)}})()?(()=>{switch(s){case k.choose:return i==b;case k.select:return d.includes(b)}})()?"success":"primary":(()=>{switch(s){case k.choose:return i==b;case k.select:return d.includes(b)}})()?"error":"default":"default"}return e.jsxs(x,{gap:"8",direction:"column",children:[e.jsxs(x,{className:"gap-4 max-sm:gap-2",placeContent:"space-between",children:[e.jsx(F,{variant:"h3",className:"font-bold sm:text-lg",extractor:"$",dir:"ltr",ExtractedTextRenders:b=>e.jsx(B,{className:"inline-block",inline:!0,variant:"span",children:b}),children:`${a}. ${m}`}),e.jsxs(q,{className:"bg-tertiary-normal text-tertiary-light place-self-start text-nowrap rounded-full px-4 py-2 font-bold",variant:"span",children:[n," ",e.jsx(S,{children:p.lessons.examination.question.points[n<=1?"singular":"plural"]})]})]}),e.jsx(x,{gap:"4",direction:"column",children:r.map((b,f)=>e.jsx(me,{className:"[&>label]:bg-transparent",isControlled:!0,variant:T(f),name:`answer-${a}-${f}`,isRadio:s==k.choose,checked:s==k.choose?i==f:d.includes(f),label:e.jsx(F,{variant:"label",extractor:"$",ExtractedTextRenders:w=>e.jsx(B,{className:"inline-block",inline:!0,variant:"span",children:w}),children:b}),onChange:w=>!v&&(s==k.choose?g(f):y(t=>w.target.checked?[...t,f]:t.filter(z=>z!=f)))},f))},`${i??-1}-${(d==null?void 0:d.length)??0}`)]})},X="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='32'%20height='32'%20viewBox='0%200%2016%2016'%3e%3cpath%20fill='currentColor'%20d='M2.5%2015a.5.5%200%201%201%200-1h1v-1a4.5%204.5%200%200%201%202.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5%204.5%200%200%201%203.5%203V2h-1a.5.5%200%200%201%200-1h11a.5.5%200%200%201%200%201h-1v1a4.5%204.5%200%200%201-2.557%204.06c-.29.139-.443.377-.443.59v.7c0%20.213.154.451.443.59A4.5%204.5%200%200%201%2012.5%2013v1h1a.5.5%200%200%201%200%201zm2-13v1c0%20.537.12%201.045.337%201.5h6.326c.216-.455.337-.963.337-1.5V2zm3%206.35c0%20.701-.478%201.236-1.011%201.492A3.5%203.5%200%200%200%204.5%2013s.866-1.299%203-1.48zm1%200v3.17c2.134.181%203%201.48%203%201.48a3.5%203.5%200%200%200-1.989-3.158C8.978%209.586%208.5%209.052%208.5%208.351z'%20/%3e%3c/svg%3e",Se=h.object({tab:h.string({required_error:"required"}).regex(/\d*/,"pattern").default("0")}),Te=({lesson:s,courseID:a,moduleID:m,lessonID:n,enrollment:c})=>{const{myUser:l}=Z(),{isDarkThemed:r}=G(),{direction:i,language:d,GetGenderedLocale:g}=M(),{queryParams:y,setQueryParams:v}=ge(Se),{StoreTab:T,StartExamination:b,FinalizeExamination:f,TerminateExamination:w,examinationInformation:t,SetExaminationChosenAnswers:z}=A(),[$,W]=I.useState(J()),[j,K]=I.useState((t==null?void 0:t["last-tab"])??+y.tab);I.useEffect(()=>{T(j),v(o=>({...o,tab:`${j+1}`}))},[j]),I.useEffect(()=>{if(t==null)return;const o=setInterval(()=>{t==null&&clearInterval(o),W(J())},500);return()=>{clearInterval(o)}},[t==null?void 0:t["finishes-at"]]);const ae=o=>u=>z(C=>C.with(o,typeof u=="number"?u:u==null?void 0:u(C[o]))),te=o=>u=>z(C=>C.with(o,Array.isArray(u)?u:u==null?void 0:u(C[o])));function J(){return t==null?s.time*60*1e3:Math.max(-1,new Date(t["finishes-at"]).getTime()-Date.now())}function re(o){const u=Math.floor(Math.max(0,o)/1e3),C=Math.floor(u/60),ne=u%60;return`${C.toString().padStart(2,"0")}:${ne.toString().padStart(2,"0")}`}const D=t!=null&&[t.courseID==a,t.moduleID==m,t.lessonID==n].every(Boolean),U=D&&(t["check-my-answers"]||!t.finalized&&t["chosen-answers"].map(o=>Array.isArray(o)?o.length>0:o!=null).every(Boolean)),O=D&&t.finalized&&t["check-my-answers"];return e.jsxs(x,{className:"grow",gap:"8",direction:"column",children:[e.jsxs(x,{gap:"4",placeItems:"end",placeContent:"space-between",children:[e.jsx(q,{className:"text-xl font-bold max-sm:text-lg",variant:"h1",children:s.title}),D&&$>=0&&e.jsxs(x,{className:N("border-background-darker max-sm:text-md translate-y-2 text-nowrap rounded-2xl border-2 px-4 py-2 text-lg",r?"bg-background-normal/50":"bg-background-dark/50"),gap:"2",placeItems:"center",children:[e.jsx(ce,{className:"hourglass-icon aspect-square max-sm:w-[24px] [&>svg]:h-full [&>svg]:w-full",source:X}),e.jsx("span",{className:"min-w-[5ch] text-end",children:re($)})]})]}),e.jsx(x,{className:N("sm:border-background-darker relative min-h-[60dvh] grow p-4 max-sm:-mx-8 max-sm:-mt-4 sm:rounded-2xl sm:border-2",r?"sm:bg-background-normal/50":"sm:bg-background-dark/50"),children:t==null?e.jsx(E,{className:"sm:-translate-1/2 sm:absolute sm:left-1/2 sm:top-1/2",iconType:"custom",iconProps:{source:be},title:g(p.lessons.examination.disclaimer.title,d,l.gender),paragraph:g(p.lessons.examination.disclaimer.paragraph,d,l.gender).replace(/\*\*([^\*]+)\*\*/g,o=>o.startsWith("**#")?`**${s.time}**`:o),buttons:e.jsx(_,{thickness:"thick",onClick:o=>b({courseID:a,lessonID:n,moduleID:m,"last-tab":0,finalized:!1,"check-my-answers":!1,"finishes-at":new Date(Date.now()+s.time*60*1e3).toISOString(),"chosen-answers":s.questions.map(u=>{switch(u.type){case k.choose:return;case k.select:return[]}})}),children:e.jsx(S,{gender:l.gender,children:p.lessons.examination.disclaimer.buttons.proceed})})}):$==-1&&t!=null?e.jsx(E,{className:"sm:-translate-1/2 sm:absolute sm:left-1/2 sm:top-1/2",iconType:"custom",iconProps:{source:X},title:g(p.lessons.examination["times-up"].title,d,l.gender),paragraph:g(p.lessons.examination["times-up"].paragraph,d,l.gender).replace(/\*\*([^\*]+)\*\*/g,o=>o.startsWith("**#")?`**${s.time}**`:o),buttons:e.jsx(_,{thickness:"thick",onClick:o=>(w(),W(1/0)),children:e.jsx(S,{gender:l.gender,children:p.lessons.examination["times-up"].buttons.reset})})}):e.jsxs(x,{className:"w-full sm:p-4",gap:"8",direction:"column",children:[(()=>{switch(s.questions[j].type){case k.choose:return e.jsx(H,{index:j+1,...s.questions[j],showCorrectAnswers:O,setChosenAnswer:ae(j),chosenAnswer:t["chosen-answers"][j]});case k.select:return e.jsx(H,{index:j+1,...s.questions[j],showCorrectAnswers:O,setChosenAnswers:te(j),chosenAnswers:t["chosen-answers"][j]})}})(),e.jsxs(x,{className:"mt-auto",placeContent:"space-between",children:[e.jsx(_,{className:"min-w-[calc(8ch+1rem)]",disabled:j==0,icon:{placement:"left",source:Y,className:i=="ltr"?"rotate-270":"rotate-90"},onClick:o=>K(u=>u-1),children:e.jsx(S,{children:p.lessons.examination.question.buttons.previous})}),e.jsx(q,{className:"bg-tertiary-normal text-tertiary-light min-w-[calc(3ch+2rem)] place-self-start text-nowrap rounded-full px-4 py-2 text-center font-bold",variant:"p",children:j+1}),e.jsx(_,{className:"min-w-[calc(8ch+1rem)]",disabled:j==s.questions.length-1,icon:{placement:"right",source:Y,className:i=="ltr"?"rotate-90":"rotate-270"},onClick:o=>K(u=>u+1),children:e.jsx(S,{children:p.lessons.examination.question.buttons.next})})]})]})}),e.jsx(P,{direction:"reverse-row",children:e.jsx(_,{className:N(c=="passed"&&"font-bold",c=="unenrolled"&&"pointer-events-none opacity-0"),thickness:"thick",variant:c=="passed"?"success":"default",disabled:$==0&&t!=null||c!="enrolled"||!U,tabIndex:$==0&&t!=null||c!="enrolled"||!U?0:-1,icon:D&&c!="passed"?void 0:{placement:"right",source:c=="passed"?V:Q},onClick:o=>t!=null&&t["check-my-answers"]?w():D?f():void 0,children:e.jsx(S,{children:p.lessons.buttons[c=="passed"?"completed":D?"finish-exam":"mark-completeness"]})})})]})},Ue=()=>{const{myUser:s}=Z(),{isDarkThemed:a}=G(),{isScreenSize:m}=le(),{language:n,GetLocale:c}=M(),{courseID:l,moduleID:r,lessonID:i}=ie(),{examinationInformation:d}=A(),{data:g}=he(l,r,{usesSuspense:!0}),{data:y}=fe(l,r,i,{usesSuspense:!0}),{data:v}=je(l,s==null?void 0:s.username,{usesSuspense:!0,enabled:l!=null&&s!=null}),T=v==null?void 0:v.progress.find(w=>w.module==(g==null?void 0:g.id));if(l==null||r==null)return e.jsx(E,{className:"grow",iconType:"empty",title:c(p.display.empty.title,n),paragraph:c(p.display.empty.paragraph,n).replace(/\*\*([^\*]+)\*\*/,`**"${l}"**`)});if(i==null||y==null)return e.jsx(E,{className:"grow",iconType:"empty",title:c(p.lessons.empty.title,n),paragraph:c(p.lessons.empty.paragraph,n).replace(/\*\*([^\*]+)\*\*/,`**"${r}"**`)});const b=Number(i??0)-1,f=v==null||T==null?"unenrolled":b<T["finished-lessons"]?"passed":b>T["finished-lessons"]?"unenrolled":"enrolled";return e.jsxs(x,{className:"grow",gap:"8",variant:"main",direction:m["max-xl"]?"column-reverse":"row",children:[e.jsx(de,{children:y.title}),e.jsx(xe,{className:N("border-background-darker rounded-2xl border-2 xl:max-h-[calc(100dvh-var(--spacing-page)*2-var(--spacing)*16)] xl:min-w-[32rem] xl:max-w-[32rem] xl:overflow-y-auto xl:overflow-x-hidden",a?"bg-background-normal/50":"bg-background-dark/50"),orientation:m["max-sm"]||m.xl?"portrait":"landscape"}),(()=>{switch(y.type){case R.video:return e.jsx(ke,{lesson:y,enrollment:f});case R.reading:return e.jsx(Ne,{lesson:y,enrollment:f});case R.examination:return e.jsx(Te,{lesson:y,enrollment:f,courseID:l,moduleID:r,lessonID:i},`${(d==null?void 0:d.finalized)??!1}${(d==null?void 0:d["check-my-answers"])??!1}`)}})()]})};export{Ue as LessonPage};
