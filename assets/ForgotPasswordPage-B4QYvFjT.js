import{z as u,ah as k,u as j,j as e,L as d,w as q,R as v,B as b,g as T,r as w}from"./index-C0wR2zzs.js";import{u as y,F as P,H as R}from"./HTTPManager-C5NgQxqR.js";import{I as E}from"./Input-CAFURA4_.js";import{R as g}from"./RichText-BP2Evu8U.js";import{S as C,P as S,u as F}from"./StateButton-Cl9IRPg1.js";import{u as G}from"./useSchematicQueryParams-BRFB-V0Q.js";import"./ButtonBox-B4R0oyCe.js";import"./index-DTX8tjxq.js";import"./check-CUtO5-iS.js";import"./network_error-BFEUb7Sm.js";const f={"code-request":u.object({email:u.string({required_error:"required"}).email("pattern")}),"code-verification":u.object({code:u.string({required_error:"required"}).length(6,"length")}),"reset-password":u.object({password:u.string({required_error:"required"}).min(8,"minimum").max(20,"maximum"),"confirm-password":u.string({required_error:"required"})}).refine(s=>s.password==s["confirm-password"],{message:"match",path:["confirm-password"]})};k(f["code-request"],f["code-verification"],f["reset-password"]);const O={"code-request":{en:"Get code via email",ar:"احصُلْ على رَمزٍ عَبرَ البَريدِ الإلكترونيّ"},"code-verification":{en:"Enter code",ar:"أدخلْ الرَّمز"},"reset-password":{en:"Reset password",ar:"أعدْ ضَبطَ كَلمةِ المُرور"}},M={email:{label:{en:"Email",ar:"البَريدُ الإلكترونيّ"},placeholder:{en:"example@gmail.com",ar:"أدخلْ بَريدكَ الإلكترونيّ"},errors:{required:{en:"Email is required.",ar:"البَريدُ الإلكترونيُّ إلزاميّ."},pattern:{en:"Email should be written as 'example@gmail.com'.",ar:"يَجبُ على البَريدِ الإلكترونيّ أنْ يُكتَبَ كالتّالي 'example@gmail.com'."}}},code:{label:{en:"Code",ar:"الرّمز"},placeholder:{en:"Enter received code",ar:"أدخلْ الرّمزَ الّذي حَصلتَ عليه"},errors:{required:{en:"Code is required.",ar:"إدخالُ الرّمزِ إلزاميّ"},length:{en:"Code should consist only of 6 characters.",ar:"يَجبُ على الرّمزِ أنْ يَتألّفَ مِن 6 حُروفٍ فَقط."}}},password:{label:{en:"Password",ar:"كلمةُ المُرور"},placeholder:{en:"Enter new password",ar:"أدخلْ كلمةَ مُرورٍ جديدةٍ"},errors:{required:{en:"Password is required.",ar:"كَلمةُ المُرورِ إلزاميّة."},minimum:{en:"Password should consist of more than 8 characters.",ar:"يَجبُ على كَلمةِ المُرورِ أنْ تَتألّفَ مِن أكثرِ مِن 8 حُروف."},maximum:{en:"Password should not exceed 20 characters.",ar:"يَجبُ على كَلمةِ المُرورِ ألّا تَتعدّى 20 حَرفاً."}}},"confirm-password":{label:{en:"Confirm Password",ar:"تأكيدُ كلمةِ المُرور"},placeholder:{en:"Re-enter previous password",ar:"أعدْ إدخالَ كلمةِ المُرورِ السّابقةِ"},errors:{required:{en:"You have to confirm previous password.",ar:"عليكَ أنْ تُأكّدَ كِتابةَ كَلمةِ المُرورِ السّابقة."},match:{en:"Passwords must match.",ar:"يَجبُ على كَلمتيِّ المُرورِ أنْ تَتطابقا."}}}},L={"send-code":{en:"Send Code",ar:"ارسلْ الرَمز"},"verify-code":{en:"Verify Code",ar:"تَحقّقْ مِن الرّمز"},"reset-password":{en:"Reset Password",ar:"أعدْ ضَبطَ كَلمةِ المُرور"},clear:{en:"Clear",ar:"مسحُ المَكتوب"}},D={"code-resent":{en:"Code resent.",ar:"تَمّ إعادةُ إرسالُ الرّمز."}},r={title:O,inputs:M,buttons:L,"last-option":{"code-request":{en:"Changed your mind? **Go Back**.",ar:"غَيّرتَ رأيَك؟ **عُدْ لِلخَلف**."},"code-verification":{"go-back":{en:"Changed your mind? **Go Back**.",ar:"غَيّرتَ رأيَك؟ **عُدْ لِلخَلف**."},"resend-code":{en:"Haven't received code? **Resend**.",ar:"لَمْ يَصِلكَ رَمزٌ بَعد؟ **أعدْ الإرسال**."}},"reset-password":{en:"Changed your mind? **Go Back**.",ar:"غَيّرتَ رأيَك؟ **عُدْ لِلخَلف**."}},toasts:D},N=({SubmitData:s,mutationProps:n})=>{var o;const{GetLocale:t,GetErrorLocale:i,language:c}=j(),{reset:m,register:p,handleSubmit:x,formState:{errors:h}}=y(f["code-request"]);return e.jsx(P,{onSubmit:x(s),title:e.jsx(d,{variant:"h1",className:"text-xl font-bold",children:r.title["code-request"]}),buttons:e.jsxs(e.Fragment,{children:[e.jsx(b,{type:"reset",onClick:a=>m(),children:e.jsx(d,{children:r.buttons.clear})}),e.jsx(C,{type:"submit",variant:"primary",...n,children:e.jsx(d,{children:r.buttons["send-code"]})})]}),lastOptions:e.jsx(g,{variant:"p",ExtractedTextRenders:a=>e.jsx(q,{className:"text-primary-normal underline",to:v.base.routes.login.absolute,children:a}),children:t(r["last-option"]["code-request"],c)}),children:e.jsx(E,{required:!0,autoFocus:!0,type:"email",...p("email"),label:e.jsx(d,{children:r.inputs.email.label}),errorMessage:i((o=h.email)==null?void 0:o.message,r.inputs.email.errors,c),placeholder:t(r.inputs.email.placeholder,c)})})},A=({SubmitData:s,mutationProps:n})=>{var o,a;const{GetLocale:t,GetErrorLocale:i,language:c}=j(),{reset:m,register:p,handleSubmit:x,formState:{errors:h}}=y(f["reset-password"]);return e.jsxs(P,{onSubmit:x(s),title:e.jsx(d,{variant:"h1",className:"text-xl font-bold",children:r.title["reset-password"]}),buttons:e.jsxs(e.Fragment,{children:[e.jsx(b,{type:"reset",onClick:l=>m(),children:e.jsx(d,{children:r.buttons.clear})}),e.jsx(C,{type:"submit",variant:"primary",...n,children:e.jsx(d,{children:r.buttons["reset-password"]})})]}),lastOptions:e.jsx(g,{variant:"p",ExtractedTextRenders:l=>e.jsx(q,{className:"text-primary-normal underline",to:v.base.routes.login.absolute,children:l}),children:t(r["last-option"]["reset-password"],c)}),children:[e.jsx(S,{required:!0,autoFocus:!0,autoComplete:"off",...p("password"),label:e.jsx(d,{children:r.inputs.password.label}),errorMessage:i((o=h.password)==null?void 0:o.message,r.inputs.password.errors,c),placeholder:t(r.inputs.password.placeholder,c)}),e.jsx(S,{required:!0,autoComplete:"off",...p("confirm-password"),errorMessage:i((a=h["confirm-password"])==null?void 0:a.message,r.inputs["confirm-password"].errors,c),placeholder:t(r.inputs["confirm-password"].placeholder,c),label:e.jsx(d,{children:r.inputs["confirm-password"].label})})]})},B=({SubmitData:s})=>{var a;const{GetLocale:n,GetErrorLocale:t,language:i}=j(),{Alert:c}=T(),{reset:m,register:p,handleSubmit:x,formState:{errors:h}}=y(f["code-verification"]);function o(){c(n(r.toasts["code-resent"],i),{type:"info"})}return e.jsx(P,{onSubmit:x(s),title:e.jsx(d,{variant:"h1",className:"text-xl font-bold",children:r.title["code-verification"]}),options:e.jsx(g,{variant:"p",ExtractedTextRenders:l=>e.jsx("span",{className:"text-secondary-normal cursor-pointer underline",onClick:o,children:l}),children:n(r["last-option"]["code-verification"]["resend-code"],i)}),buttons:e.jsxs(e.Fragment,{children:[e.jsx(b,{type:"reset",onClick:l=>m(),children:e.jsx(d,{children:r.buttons.clear})}),e.jsx(b,{variant:"primary",type:"submit",children:e.jsx(d,{children:r.buttons["verify-code"]})})]}),lastOptions:e.jsx(g,{variant:"p",ExtractedTextRenders:l=>e.jsx(q,{className:"text-primary-normal underline",to:`${v.base.routes["forgot-password"].absolute}?step=code-request`,children:l}),children:n(r["last-option"]["code-verification"]["go-back"],i)}),children:e.jsx(E,{required:!0,autoFocus:!0,autoComplete:"off",...p("code"),label:e.jsx(d,{children:r.inputs.code.label}),errorMessage:t((a=h.code)==null?void 0:a.message,r.inputs.code.errors,i),placeholder:n(r.inputs.code.placeholder,i)})})},I="reset-password",K=(s,n)=>F({...s,mutationKey:[I],mutationFn:t=>R.post("/auth/reset-password",Object.omit(t,"confirm-password"))},n),V="forgot-password",H=(s,n)=>F({...s,mutationKey:[V],mutationFn:t=>R.post("/auth/forgot-password",t)},n);var _=(s=>(s.codeRequest="code-request",s.resetPassword="reset-password",s.codeVerification="code-verification",s))(_||{});const Q=u.object({step:u.nativeEnum(_).default("code-request")}),se=()=>{const{queryParams:s,setQueryParams:n}=G(Q),[t,i]=w.useState({}),c=K(),m=H();w.useEffect(()=>{if(s==null){n(o=>({step:"code-request"}));return}switch(s.step){case"code-verification":t["code-request"]==null&&n(o=>({step:"code-request"}));break;case"reset-password":(t["code-request"]==null||t["code-verification"]==null)&&n(o=>({step:"code-request"}));break}},[s]),w.useEffect(()=>{const{data:o,success:a}=f["code-request"].safeParse(t["code-request"]);a&&m.mutateAsync(o).then(l=>l.data).then(console.log).catch(console.error)},[t["code-request"]]),w.useEffect(()=>{const{data:o,success:a}=f["reset-password"].safeParse(t["reset-password"]);a&&c.mutateAsync(o).then(l=>l.data).then(console.log).catch(console.error)},[t["reset-password"]]);function p(o){i(a=>({...a,"code-request":o})),n(a=>({step:"code-verification"}))}function x(o){i(a=>({...a,"code-verification":o})),n(a=>({step:"reset-password"}))}function h(o){i(a=>({...a,"reset-password":o}))}switch(s==null?void 0:s.step){case"code-request":return e.jsx(N,{SubmitData:p,mutationProps:Object.pick(m,"reset","isError","isPending","isSuccess")});case"code-verification":return e.jsx(B,{SubmitData:x});case"reset-password":return e.jsx(A,{SubmitData:h,mutationProps:Object.pick(c,"reset","isError","isPending","isSuccess")})}};export{se as ForgotPasswordPage,_ as ForgotPasswordStepEnum};
